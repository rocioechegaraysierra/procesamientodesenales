<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sintetizador UNTREF - Procesamiento de Señales</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <py-config>
        packages = ["numpy", "matplotlib"]
    </py-config>

    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .loading { color: orange; font-weight: bold; }
        #plot { margin-top: 20px; min-height: 300px; background: #f9f9f9; border: 1px solid #ddd; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:disabled { background-color: #ccc; }
    </style>
</head>
<body>
    <h1>Sintetizador de Señales</h1>
    <p>Procesamiento de Señales - UNTREF</p>
    
    <div id="status" class="loading">Cargando Python y Librerías... por favor espere</div>
    <hr>

    <div id="controls" style="display:none;">
        <label>Frecuencia :</label>
        <input type="number" id="freq" value="440" step="10"> Hz
        <br><br>
        <label>Tipo de onda:</label>
        <select id="wave-type">
            <option value="sin">Senoidal</option>
            <option value="square">Cuadrada</option>
            <option value="triangle">Triangular</option>
            <option value="sawtooth">Diente de Sierra</option>
        </select>
        <br><br>
        <button id="btn-generate" py-click="generate_signal">Generar y Graficar</button>
    </div>

    <div id="plot"></div>

    <script type="py">
        import numpy as np
        import matplotlib.pyplot as plt
        from pyscript import display
        from js import document

        # Quitar el mensaje de carga cuando Python esté listo
        document.getElementById("status").style.display = "none"
        document.getElementById("controls").style.display = "block"

        def generate_signal(event):
            # 1. Configuración de Muestreo (Unidad 3)
            fs = 44100  # Frecuencia de muestreo
            duration = 0.005  # Ventana de tiempo corta para ver la forma de onda
            t = np.linspace(0, duration, int(fs * duration), endpoint=False)
            
            # 2. Captura de datos
            try:
                f = float(document.getElementById("freq").value)
            except:
                f = 440.0
            
            wave_type = document.getElementById("wave-type").value
            
            # 3. Generación matemática de la señal (Unidad 2) 
            if wave_type == "sin":
                y = np.sin(2 * np.pi * f * t)
            elif wave_type == "square":
                y = np.sign(np.sin(2 * np.pi * f * t))
            elif wave_type == "triangle":
                y = 2 * np.abs(2 * (t * f - np.floor(t * f + 0.5))) - 1
            elif wave_type == "sawtooth":
                y = 2 * (t * f - np.floor(t * f + 0.5))
            else:
                y = np.zeros(len(t))

            # 4. Visualización (Unidad 8) 
            plt.close('all')
            fig, ax = plt.subplots(figsize=(7, 4))
            ax.plot(t, y, 'b-', linewidth=2)
            ax.set_title(f"Onda {wave_type.capitalize()} a {f} Hz")
            ax.set_xlabel("Tiempo [s]")
            ax.set_ylabel("Amplitud")
            ax.grid(True)
            
            # Limpiar div y mostrar
            plot_div = document.getElementById("plot")
            plot_div.innerHTML = ""
            display(fig, target="plot")
    </script>
</body>
</html>